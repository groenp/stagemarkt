function build_fltrd_sbscrbrs_table(s){$("#sbscrbr_table td.fltr input.chk").each(function(){$(this).val($(this).val().toUpperCase())});var r="sbscrbr_login",e="pk_sbscrbr_id",t="";if(""!=$("#fltr_pk_sbscrbr_id").val()&&(r="pk_sbscrbr_id",e="",t=""),""!=$("#fltr_sbscrbr_name").val()&&(r="last",e="first",t="sbscrbr_login"),""!=$("#fltr_user_email").val()&&(r="user_email",e="sbscrbr_login",t="pk_sbscrbr_id"),""!=$("#fltr_user_registered").val()&&(r="user_registered",e="sbscrbr_login",t="pk_sbscrbr_id"),Sbscrbrs.sort(srt_by(r,e,t)),$("#sbscrbr_table").find("tr:gt(1)").remove(),""!=$("#fltr_pk_sbscrbr_id").val())var b=$("#fltr_pk_sbscrbr_id").val();if(""!=$("#fltr_sbscrbr_login").val())var l=$("#fltr_sbscrbr_login").val();if(""!=$("#fltr_sbscrbr_name").val())var i=$("#fltr_sbscrbr_name").val();if(""!=$("#fltr_user_email").val())var a=$("#fltr_user_email").val();if(""!=$("#fltr_user_registered").val())var _=$("#fltr_user_registered").val();if("y"===$("#fltr_gets_html_mail").val().toLowerCase())var c=1;else if("n"===$("#fltr_gets_html_mail").val().toLowerCase())c=0;else if("*"===$("#fltr_gets_html_mail").val())c="*";if("y"===$("#fltr_is_usr_blocked").val().toLowerCase())var n=1;else if("n"===$("#fltr_is_usr_blocked").val().toLowerCase())n=0;else if("*"===$("#fltr_is_usr_blocked").val())n="*";if(""!=$("#fltr_sbscrbr_notes").val())var o=$("#fltr_sbscrbr_notes").val();for(var d=0;d<Sbscrbrs.length;d++)if((!b||Sbscrbrs[d].pk_sbscrbr_id&&("*"==b&&Sbscrbrs[d].pk_sbscrbr_id||b&&Sbscrbrs[d].pk_sbscrbr_id.indexOf(b)>=0))&&(!l||Sbscrbrs[d].sbscrbr_login&&("*"==l&&Sbscrbrs[d].sbscrbr_login||l&&Sbscrbrs[d].sbscrbr_login.toLowerCase().indexOf(l.toLowerCase())>=0))&&(!i||(Sbscrbrs[d].first||Sbscrbrs[d].last)&&("*"==i&&(Sbscrbrs[d].first||Sbscrbrs[d].last)||i&&Sbscrbrs[d].first.toLowerCase().indexOf(i.toLowerCase())>=0||i&&Sbscrbrs[d].last.toLowerCase().indexOf(i.toLowerCase())>=0))&&(!a||Sbscrbrs[d].user_email&&("*"==a&&Sbscrbrs[d].user_email||a&&Sbscrbrs[d].user_email.toLowerCase().indexOf(a.toLowerCase())>=0))&&(!_||Sbscrbrs[d].user_registered&&("*"==_&&Sbscrbrs[d].user_registered||_&&loc(Sbscrbrs[d].user_registered).toLowerCase().indexOf(_.toLowerCase())>=0))&&(null==c||Sbscrbrs[d].gets_html_mail&&("*"==c&&Sbscrbrs[d].gets_html_mail||null!=c&&Sbscrbrs[d].gets_html_mail==c))&&(null==n||Sbscrbrs[d].is_usr_blocked&&("*"==n&&Sbscrbrs[d].is_usr_blocked||null!=n&&Sbscrbrs[d].is_usr_blocked==n))&&(!o||Sbscrbrs[d].sbscrbr_notes&&("*"==o&&Sbscrbrs[d].sbscrbr_notes||o&&Sbscrbrs[d].sbscrbr_notes.toLowerCase().indexOf(o.toLowerCase())>=0))){var p=null==Sbscrbrs[d].last||""==Sbscrbrs[d].last?"":Sbscrbrs[d].last+", ";p+=null==Sbscrbrs[d].first?"":Sbscrbrs[d].first,$("#sbscrbr_table").find("tbody").append($("<tr>").append($("<td>").text(Sbscrbrs[d].pk_sbscrbr_id).addClass("numb")).append($("<td>").text(Sbscrbrs[d].sbscrbr_login)).append($("<td>").html(escapeSpecialChars(p))).append($("<td>").html(escapeSpecialChars(Sbscrbrs[d].user_email))).append($("<td>").text(loc(Sbscrbrs[d].user_registered)))),"1"==Sbscrbrs[d].gets_html_mail?$("#sbscrbr_table tr:last").append($("<td>").text("Y").addClass("chck")):$("#sbscrbr_table tr:last").append($("<td>")),"1"==Sbscrbrs[d].is_usr_blocked?$("#sbscrbr_table tr:last").append($("<td>").text("Y").addClass("chck")):$("#sbscrbr_table tr:last").append($("<td>")),$("#sbscrbr_table tr:last").append($("<td>").html(escapeSpecialChars(Sbscrbrs[d].sbscrbr_notes))),$("#sbscrbr_table tr:last").append($("<td>").append("<input type='submit' name='"+Sbscrbrs[d].pk_sbscrbr_id+"' value='Edit'/>")),$("#sbscrbr_table tr:last td:last").append("&nbsp;<input type='submit' name='"+Sbscrbrs[d].pk_sbscrbr_id+"' value='Delete'/>")}$("#sbscrbr_table td").html().replace(/(undefined)*/g,""),$('#sbscrbr_table input[type="submit"][value="Edit"]').addClass("button-primary"),$('#sbscrbr_table input[type="submit"][value="Delete"]').addClass("button-secondary").click(function(){confirm_deletion("sure_"+s)})}function show_sbscrbr_filter(){$("#test_spp_sbscrbr_login").val($("#spp_sbscrbr_login").val()),$('#sbscrbr_display input[type="button"]').hide(),$("#sbscrbr_filter").show()}function select_sbscrbr(){$("#spp_sbscrbr_id").val(Sbscrbrs[$("#sbscrbr_logins option:selected").val()].pk_sbscrbr_id),$("#spp_sbscrbr_login").val($("#sbscrbr_logins option:selected").text()),$("#sbscrbr_display").show(),$('#sbscrbr_display input[type="button"]').show(),$("#sbscrbr_filter").hide(),$("#fltr_sbscrbr_results").hide(),$('input[type="submit"]').removeAttr("disabled")}function filter_sbscrbrs(){var s=$("#test_spp_sbscrbr_login").val(),r=0;if($("#test_spp_sbscrbr_login").removeClass("verf-ok verf-err"),$("#sbscrbr_logins option").remove(),$("#fltr_sbscrbr_results").hide(),$("#sbscrbr_details").hide(),$("#sbscrbr_display").show(),$('#sbscrbr_display input[type="button"]').hide(),$("#fltr_sbscrbr_results .multi_res").show(),$("#err1_fltr_sbscrbr_login").hide(),$("#err2_fltr_sbscrbr_login").hide(),s.length<3)return $("#err1_fltr_sbscrbr_login").show(),$("#test_spp_sbscrbr_login").addClass("verf-err"),!1;for(var e=0;e<Sbscrbrs.length;e++)-1!=Sbscrbrs[e].sbscrbr_login.indexOf(s)&&($("#sbscrbr_logins").append("<option value="+e+">"+Sbscrbrs[e].sbscrbr_login+"</option>"),r++);r>=2?($('#fltr_sbscrbr_results input[type="button"]').attr("disabled","disabled"),$("#fltr_sbscrbr_results").show()):1==r?($("#test_spp_sbscrbr_login").val($("#sbscrbr_logins option:selected").text()),$("#test_spp_sbscrbr_login").addClass("verf-ok"),$("#fltr_sbscrbr_results").show(),$("#sbscrbr_logins").val($("#sbscrbr_logins option:eq(0)").val()),$("#fltr_sbscrbr_results .multi_res").hide(),show_sbscrbr_det()):0==r&&($("#err2_fltr_sbscrbr_login").show(),$("#test_spp_sbscrbr_login").addClass("verf-err"),$("#fltr_sbscrbr_results").hide())}function show_sbscrbr_det(){var s=0;-1!=$("#sbscrbr_logins")[0].selectedIndex?(s=$("#sbscrbr_logins option:selected").val(),$("#test_spp_sbscrbr_login").val(Sbscrbrs[s].sbscrbr_login),$("#spp_user_registered").text(loc(Sbscrbrs[s].user_registered)),$("#spp_sbscrbr_name").html(escapeSpecialChars(Sbscrbrs[s].first)+"&nbsp;"+escapeSpecialChars(Sbscrbrs[s].last)),$("#spp_user_email").text(Sbscrbrs[s].user_email),$("#spp_sbscrbr_notes").html(escapeSpecialChars(Sbscrbrs[s].sbscrbr_notes)),"first"in Sbscrbrs[s]?$(".wp_registered").show():$(".wp_registered").hide(),$('#fltr_sbscrbr_results input[type="button"]').removeAttr("disabled"),$("#sbscrbr_details").show()):$("#sbscrbr_details").hide()}function confirm_deletion(s){$("#"+s).val(confirm("Select 'OK' to confirm deletion.")?"yes":"no")}function confirm_attachment(s){$("#"+s).val(confirm("Select 'OK' to confirm attaching wp_user.")?"yes":"no")}function msg_sub_deletion_not_implemented(){alert("ONLY DO THIS WHEN SUBSCRIPTION WAS COMPLETELY WRONG AND REPAIR AFTER (LIKE USE A FREE SLOT, ADJUST CHARGES, PAYMENTS, ETC.)\n\nInstructions for database:\n1) delete all muts of this subscription (make sure any valid ones (payment) get added later)\n2) delete subscription (it is wrong and should not have been created in the first place)\n3) change establishment: is_subscribed = false, gets_usr_mails = NULL, is_sponsor = NULL.")}function clear_filter(s){$("#"+s+' td.fltr>input[type="text"], #'+s+" td.fltr>select").val(""),$("#"+s+' td.head>input[type="text"], #'+s+" td.head>select").val("")}function srt_by(s,r,e){return function(t,b){return!isNaN(t[s])&&!isNaN(b[s])&&parseInt(t[s])-parseInt(b[s])>0||null==t[s]&&null!=b[s]||null!=t[s]&&isNaN(t[s])&&null!=b[s]&&isNaN(b[s])&&t[s].toLowerCase()>b[s].toLowerCase()?1:!isNaN(t[s])&&!isNaN(b[s])&&parseInt(t[s])-parseInt(b[s])<0||null!=t[s]&&null==b[s]||null!=t[s]&&isNaN(t[s])&&null!=b[s]&&isNaN(b[s])&&t[s].toLowerCase()<b[s].toLowerCase()?-1:!isNaN(t[r])&&!isNaN(b[r])&&parseInt(t[r])-parseInt(b[r])>0||null==t[r]&&null!=b[r]||null!=t[r]&&isNaN(t[r])&&null!=b[r]&&isNaN(b[r])&&t[r].toLowerCase()>b[r].toLowerCase()?1:!isNaN(t[r])&&!isNaN(b[r])&&parseInt(t[r])-parseInt(b[r])<0||null!=t[r]&&null==b[r]||null!=t[r]&&isNaN(t[r])&&null!=b[r]&&isNaN(b[r])&&t[r].toLowerCase()<b[r].toLowerCase()?-1:!isNaN(t[e])&&!isNaN(b[e])&&parseInt(t[e])-parseInt(b[e])>0||null==t[e]&&null!=b[e]||null!=t[e]&&isNaN(t[e])&&null!=b[e]&&isNaN(b[e])&&t[e].toLowerCase()>b[e].toLowerCase()?1:!isNaN(t[e])&&!isNaN(b[e])&&parseInt(t[e])-parseInt(b[e])<0||null!=t[e]&&null==b[e]||null!=t[e]&&isNaN(t[e])&&null!=b[e]&&isNaN(b[e])&&t[e].toLowerCase()<b[e].toLowerCase()?-1:0}}$=jQuery,$(document).ready(function(){$("#sbscrbr_logins").blur(function(){-1==$("#sbscrbr_logins")[0].selectedIndex&&$('#fltr_sbscrbr_results input[type="button"]').attr("disabled","disabled")}),$("#spp_prjct_id").change(function(){var s="1"==$("#spp_prjct_id option:selected").attr("data-active")?"Yes":"No";$("#spp_is_test_active").html(s),$("#spp_dis_prjct_id").html($("#spp_prjct_id option:selected").attr("data-id")),$(this).val()?$(this).css("color","#000"):($(this).css("color","#a0a0a0"),$("#spp_is_test_active").html(""),$("#spp_dis_prjct_id").html(""))}),$("#spp_prjct_id").trigger("change"),$("#test_spp_sbscrbr_login").focus(function(){$(this).removeClass("verf-err verf-ok")}),$("#sppair_tbl tbody tr").each(function(){var s=$(this).find("td:eq(4)").text();if(s){var r=Sbscrbrs.map(function(s){return s.pk_sbscrbr_id}).indexOf(s);void 0!==Sbscrbrs[r]&&($(this).find("td:eq(4)").html(Sbscrbrs[r].first+" "+Sbscrbrs[r].last),$(this).find("td:eq(5)").html(Sbscrbrs[r].user_email),$(this).find("td:eq(6)").html(Sbscrbrs[r].sbscrbr_notes))}})});