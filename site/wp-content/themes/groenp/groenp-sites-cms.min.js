function confirm_deletion(s){$("#"+s).val(confirm("Select 'OK' to confirm deletion.")?"yes":"no")}function confirm_attachment(s){$("#"+s).val(confirm("Select 'OK' to confirm attaching wp_user.")?"yes":"no")}function msg_sub_deletion_not_implemented(){alert("ONLY DO THIS WHEN SUBSCRIPTION WAS COMPLETELY WRONG AND REPAIR AFTER (LIKE USE A FREE SLOT, ADJUST CHARGES, PAYMENTS, ETC.)\n\nInstructions for database:\n1) delete all muts of this subscription (make sure any valid ones (payment) get added later)\n2) delete subscription (it is wrong and should not have been created in the first place)\n3) change establishment: is_subscribed = false, gets_usr_mails = NULL, is_sponsor = NULL.")}function clear_filter(s){$("#"+s+' td.fltr>input[type="text"], #'+s+" td.fltr>select").val(""),$("#"+s+' td.head>input[type="text"], #'+s+" td.head>select").val("")}function build_fltrd_sbscrbrs_table(s){$("#sbscrbr_table td.fltr input.chk").each(function(){$(this).val($(this).val().toUpperCase())});var r="sbscrbr_login",t="pk_sbscrbr_id",e="";if(""!=$("#fltr_pk_sbscrbr_id").val()&&(r="pk_sbscrbr_id",t="",e=""),""!=$("#fltr_sbscrbr_name").val()&&(r="last",t="first",e="sbscrbr_login"),""!=$("#fltr_user_email").val()&&(r="user_email",t="sbscrbr_login",e="pk_sbscrbr_id"),""!=$("#fltr_user_registered").val()&&(r="user_registered",t="sbscrbr_login",e="pk_sbscrbr_id"),Sbscrbrs.sort(srt_by(r,t,e)),$("#sbscrbr_table").find("tr:gt(1)").remove(),""!=$("#fltr_pk_sbscrbr_id").val())var _=$("#fltr_pk_sbscrbr_id").val();if(""!=$("#fltr_sbscrbr_login").val())var l=$("#fltr_sbscrbr_login").val();if(""!=$("#fltr_sbscrbr_name").val())var a=$("#fltr_sbscrbr_name").val();if(""!=$("#fltr_user_email").val())var b=$("#fltr_user_email").val();if(""!=$("#fltr_user_registered").val())var i=$("#fltr_user_registered").val();if("y"===$("#fltr_gets_sub_mails").val().toLowerCase())var d=1;else if("n"===$("#fltr_gets_sub_mails").val().toLowerCase())d=0;else if("*"===$("#fltr_gets_sub_mails").val())d="*";if("y"===$("#fltr_gets_html_mail").val().toLowerCase())var n=1;else if("n"===$("#fltr_gets_html_mail").val().toLowerCase())n=0;else if("*"===$("#fltr_gets_html_mail").val())n="*";if("y"===$("#fltr_is_usr_blocked").val().toLowerCase())var o=1;else if("n"===$("#fltr_is_usr_blocked").val().toLowerCase())o=0;else if("*"===$("#fltr_is_usr_blocked").val())o="*";if(""!=$("#fltr_sbscrbr_notes").val())var c=$("#fltr_sbscrbr_notes").val();for(var p=0;p<Sbscrbrs.length;p++)if((!_||Sbscrbrs[p].pk_sbscrbr_id&&("*"==_&&Sbscrbrs[p].pk_sbscrbr_id||_&&Sbscrbrs[p].pk_sbscrbr_id.indexOf(_)>=0))&&(!l||Sbscrbrs[p].sbscrbr_login&&("*"==l&&Sbscrbrs[p].sbscrbr_login||l&&Sbscrbrs[p].sbscrbr_login.toLowerCase().indexOf(l.toLowerCase())>=0))&&(!a||(Sbscrbrs[p].first||Sbscrbrs[p].last)&&("*"==a&&(Sbscrbrs[p].first||Sbscrbrs[p].last)||a&&Sbscrbrs[p].first.toLowerCase().indexOf(a.toLowerCase())>=0||a&&Sbscrbrs[p].last.toLowerCase().indexOf(a.toLowerCase())>=0))&&(!b||Sbscrbrs[p].user_email&&("*"==b&&Sbscrbrs[p].user_email||b&&Sbscrbrs[p].user_email.toLowerCase().indexOf(b.toLowerCase())>=0))&&(!i||Sbscrbrs[p].user_registered&&("*"==i&&Sbscrbrs[p].user_registered||i&&loc(Sbscrbrs[p].user_registered).toLowerCase().indexOf(i.toLowerCase())>=0))&&(null==d||Sbscrbrs[p].gets_sub_mails&&("*"==d&&Sbscrbrs[p].gets_sub_mails||null!=d&&Sbscrbrs[p].gets_sub_mails==d))&&(null==n||Sbscrbrs[p].gets_html_mail&&("*"==n&&Sbscrbrs[p].gets_html_mail||null!=n&&Sbscrbrs[p].gets_html_mail==n))&&(null==o||Sbscrbrs[p].is_usr_blocked&&("*"==o&&Sbscrbrs[p].is_usr_blocked||null!=o&&Sbscrbrs[p].is_usr_blocked==o))&&(!c||Sbscrbrs[p].sbscrbr_notes&&("*"==c&&Sbscrbrs[p].sbscrbr_notes||c&&Sbscrbrs[p].sbscrbr_notes.toLowerCase().indexOf(c.toLowerCase())>=0))){var f=null==Sbscrbrs[p].last||""==Sbscrbrs[p].last?"":Sbscrbrs[p].last+", ";f+=null==Sbscrbrs[p].first?"":Sbscrbrs[p].first,$("#sbscrbr_table").find("tbody").append($("<tr>").append($("<td>").text(Sbscrbrs[p].pk_sbscrbr_id).addClass("numb")).append($("<td>").text(Sbscrbrs[p].sbscrbr_login)).append($("<td>").html(escapeSpecialChars(f))).append($("<td>").html(escapeSpecialChars(Sbscrbrs[p].user_email))).append($("<td>").text(loc(Sbscrbrs[p].user_registered)))),"1"==Sbscrbrs[p].gets_sub_mails?$("#sbscrbr_table tr:last").append($("<td>").text("Y").addClass("chck")):$("#sbscrbr_table tr:last").append($("<td>")),"1"==Sbscrbrs[p].gets_html_mail?$("#sbscrbr_table tr:last").append($("<td>").text("Y").addClass("chck")):$("#sbscrbr_table tr:last").append($("<td>")),"1"==Sbscrbrs[p].is_usr_blocked?$("#sbscrbr_table tr:last").append($("<td>").text("Y").addClass("chck")):$("#sbscrbr_table tr:last").append($("<td>")),$("#sbscrbr_table tr:last").append($("<td>").html(escapeSpecialChars(Sbscrbrs[p].sbscrbr_notes))),$("#sbscrbr_table tr:last").append($("<td>").append("<input type='submit' name='"+Sbscrbrs[p].pk_sbscrbr_id+"' value='Edit'/>")),$("#sbscrbr_table tr:last td:last").append("&nbsp;<input type='submit' name='"+Sbscrbrs[p].pk_sbscrbr_id+"' value='Delete'/>")}$("#sbscrbr_table td").html().replace(/(undefined)*/g,""),$('#sbscrbr_table td.chck:contains("Y")').css("background-color","#f9f7ed"),$('#sbscrbr_table input[type="submit"][value="Edit"]').addClass("button-primary"),$('#sbscrbr_table input[type="submit"][value="Delete"]').addClass("button-secondary").click(function(){confirm_deletion("sure_"+s)})}function build_fltrd_poisests_table(){$("#sub_table td.fltr input.chk").each(function(){$(this).val($(this).val().toUpperCase())});var s="poi_shrt_name",r="pk_poi_id",t="";if(""!=$("#fltr_pk_poi_id").val()&&(s="pk_poi_id",r="",t=""),""==$("#fltr_pk_est_id").val()&&""==$("#fltr_est_fk_sbscrbr_id").val()&&""==$("#fltr_est_sbscrbr_login").val()&&""==$("#fltr_est_is_usr_blocked").val()||(s="sbscrbr_login",r="poi_shrt_name",t="pk_poi_id",""!=$("#fltr_pk_est_id").val()&&(s="pk_est_id"),""!=$("#fltr_est_fk_sbscrbr_id").val()&&(s="fk_sbscrbr_id")),POIsEsts.sort(srt_by(s,r,t)),$("#est_table").find("tr:gt(1)").remove(),""!=$("#fltr_pk_poi_id").val())var e=$("#fltr_pk_poi_id").val();if(""!=$("#fltr_poi_shrt_name").val())var _=$("#fltr_poi_shrt_name").val();if(""!=$("#fltr_fk_poi_type_id").val())var l=$("#fltr_fk_poi_type_id").val();if(""!=$("#fltr_addr_street").val())var a=$("#fltr_addr_street").val();if(""!=$("#fltr_addr_area").val())var b=$("#fltr_addr_area").val();if(""!=$("#fltr_pk_est_id").val())var i=$("#fltr_pk_est_id").val();if(""!=$("#fltr_est_fk_sbscrbr_id").val())var d=$("#fltr_est_fk_sbscrbr_id").val();if(""!=$("#fltr_est_sbscrbr_login").val())var n=$("#fltr_est_sbscrbr_login").val();if("y"===$("#fltr_est_is_usr_blocked").val().toLowerCase())var o=1;else if("n"===$("#fltr_est_is_usr_blocked").val().toLowerCase())o=0;else if("*"===$("#fltr_est_is_usr_blocked").val())o="*";for(var c=0;c<POIsEsts.length;c++)(!e||POIsEsts[c].pk_poi_id&&("*"==e&&POIsEsts[c].pk_poi_id||e&&POIsEsts[c].pk_poi_id.indexOf(e)>=0))&&(!_||POIsEsts[c].poi_shrt_name&&("*"==_&&POIsEsts[c].poi_shrt_name||_&&POIsEsts[c].poi_shrt_name.toLowerCase().indexOf(_.toLowerCase())>=0))&&(!l||POIsEsts[c].fk_poi_type_id&&l&&POIsEsts[c].fk_poi_type_id.toLowerCase().indexOf(l.toLowerCase())>=0)&&(!a||POIsEsts[c].addr_street&&("*"==a&&POIsEsts[c].addr_street||a&&POIsEsts[c].addr_street.toLowerCase().indexOf(a.toLowerCase())>=0))&&(!b||POIsEsts[c].addr_area&&("*"==b&&POIsEsts[c].addr_area||b&&POIsEsts[c].addr_area.toLowerCase().indexOf(b.toLowerCase())>=0))&&(!i||POIsEsts[c].pk_est_id&&("*"==i&&POIsEsts[c].pk_est_id||i&&POIsEsts[c].pk_est_id.indexOf(i)>=0))&&(!d||POIsEsts[c].fk_sbscrbr_id&&("*"==d&&POIsEsts[c].fk_sbscrbr_id||d&&POIsEsts[c].fk_sbscrbr_id.indexOf(d)>=0))&&(!n||POIsEsts[c].sbscrbr_login&&("*"==n&&POIsEsts[c].sbscrbr_login||n&&POIsEsts[c].sbscrbr_login.toLowerCase().indexOf(n.toLowerCase())>=0))&&(null==o||POIsEsts[c].is_usr_blocked&&("*"==o&&POIsEsts[c].is_usr_blocked||null!=o&&POIsEsts[c].is_usr_blocked==o))&&($("#est_table").find("tbody").append($("<tr>").append($("<td>").text(POIsEsts[c].pk_poi_id).addClass("numb")).append($("<td>").html(escapeSpecialChars(POIsEsts[c].poi_shrt_name))).append($("<td>").text(POIsEsts[c].fk_poi_type_id)).append($("<td>").html(escapeSpecialChars(POIsEsts[c].addr_street))).append($("<td>").html(escapeSpecialChars(POIsEsts[c].addr_area))).append($("<td>").text(POIsEsts[c].pk_est_id).addClass("numb")).append($("<td>").text(POIsEsts[c].fk_sbscrbr_id).addClass("numb")).append($("<td>").text(POIsEsts[c].sbscrbr_login))),"1"==POIsEsts[c].is_usr_blocked?$("#est_table tr:last").append($("<td>").text("Y").addClass("chck")):$("#est_table tr:last").append($("<td>")),$("#est_table tr:last").append($("<td>").append("<input type='button' name='"+c+"' value='Details'/>")),POIsEsts[c].pk_est_id&&$("#est_table tr:last td:last").append("&nbsp;<input type='submit' name='"+POIsEsts[c].pk_est_id+"' value='Delete'/>"));$('#est_table input[type="button"][value="Details"]').addClass("button-primary").click(function(){show_est_details(parseInt($(this).attr("name"),10))}),$('#est_table input[type="submit"][value="Delete"]').addClass("button-secondary").click(function(){confirm_deletion("sure_Ests")})}function show_est_details(s){if(POIsEsts[s].pk_est_id)var r=!0;POIsEsts[s].pk_poi_id&&($("#pk_poi_id").text(POIsEsts[s].pk_poi_id),$("#poi_shrt_name").html(escapeSpecialChars(POIsEsts[s].poi_shrt_name)),$("#fk_poi_type_id").text(POIsEsts[s].fk_poi_type_id),$("#addr_street").html(escapeSpecialChars(POIsEsts[s].addr_street)),$("#addr_area").html(escapeSpecialChars(POIsEsts[s].addr_area))),r?($("#est_details .has_est").show(),$("#pk_est_id").text(POIsEsts[s].pk_est_id),$("#editkey").val(POIsEsts[s].pk_est_id),$("#fk_sbscrbr_id").val(POIsEsts[s].fk_sbscrbr_id),$("#est_sbscrbr_login").val(POIsEsts[s].sbscrbr_login),$("#est_details h4").text("Establishment details"),$("#is_allwd_feat").prop("checked",parseInt(POIsEsts[s].is_allwd_feat)),$("#sbscrbr_display").show(),$("#sbscrbr_filter").hide(),$("#est_details p.edit_btns").show(),$("#est_details p.add_btns").hide()):($("#pk_est_id").text(""),$("#editkey").val(POIsEsts[s].pk_poi_id),$("#fk_sbscrbr_id").val(""),$("#est_sbscrbr_login").val(""),$("#est_details .has_est").hide(),$("#est_details h4").text("POI details"),$("#sbscrbr_display").hide(),$("#test_est_sbscrbr_login").val(""),$("#sbscrbr_filter").show(),$("#est_details p.edit_btns").hide(),$("#est_details p.add_btns").show()),$("#fltr_sbscrbr_results").hide(),$("#sbscrbr_details").hide(),$("#test_est_sbscrbr_login").removeClass("verf-err verf-ok"),$("#est_details").show(),$("html, body").animate({scrollTop:$("#est_details").offset().top-40},700)}function show_sbscrbr_filter(){$("#test_est_sbscrbr_login").val($("#est_sbscrbr_login").val()),$('#sbscrbr_display input[type="button"]').hide(),$("#sbscrbr_filter").show()}function select_sbscrbr(){$("#fk_sbscrbr_id").val(Sbscrbrs[$("#sbscrbr_logins option:selected").val()].pk_sbscrbr_id),$("#est_sbscrbr_login").val($("#sbscrbr_logins option:selected").text()),$("#sbscrbr_display").show(),$('#sbscrbr_display input[type="button"]').show(),$("#sbscrbr_filter").hide(),$("#fltr_sbscrbr_results").hide(),$('input[type="submit"]').removeAttr("disabled")}function filter_sbscrbrs(){var s=$("#test_est_sbscrbr_login").val(),r=0;if($("#test_est_sbscrbr_login").removeClass("verf-ok verf-err"),$("#sbscrbr_logins option").remove(),$("#fltr_sbscrbr_results").hide(),$("#sbscrbr_details").hide(),$("#sbscrbr_display").show(),$('#sbscrbr_display input[type="button"]').hide(),$("#fltr_sbscrbr_results .multi_res").show(),$("#err1_fltr_sbscrbr_login").hide(),$("#err2_fltr_sbscrbr_login").hide(),s.length<3)return $("#err1_fltr_sbscrbr_login").show(),$("#test_est_sbscrbr_login").addClass("verf-err"),!1;for(var t=0;t<Sbscrbrs.length;t++)-1!=Sbscrbrs[t].sbscrbr_login.indexOf(s)&&($("#sbscrbr_logins").append("<option value="+t+">"+Sbscrbrs[t].sbscrbr_login+"</option>"),r++);r>=2?($('#fltr_sbscrbr_results input[type="button"]').attr("disabled","disabled"),$("#fltr_sbscrbr_results").show()):1==r?($("#test_est_sbscrbr_login").val($("#sbscrbr_logins option:selected").text()),$("#test_est_sbscrbr_login").addClass("verf-ok"),$("#fltr_sbscrbr_results").show(),$("#sbscrbr_logins").val($("#sbscrbr_logins option:eq(0)").val()),$("#fltr_sbscrbr_results .multi_res").hide(),show_sbscrbr_det()):0==r&&($("#err2_fltr_sbscrbr_login").show(),$("#test_est_sbscrbr_login").addClass("verf-err"),$("#fltr_sbscrbr_results").hide())}function show_sbscrbr_det(){var s=0;-1!=$("#sbscrbr_logins")[0].selectedIndex?(s=$("#sbscrbr_logins option:selected").val(),$("#test_est_sbscrbr_login").val(Sbscrbrs[s].sbscrbr_login),$("#est_user_registered").text(loc(Sbscrbrs[s].user_registered)),$("#est_sbscrbr_name").html(escapeSpecialChars(Sbscrbrs[s].first)+"&nbsp;"+escapeSpecialChars(Sbscrbrs[s].last)),$("#est_user_email").text(Sbscrbrs[s].user_email),$("#est_sbscrbr_notes").html(escapeSpecialChars(Sbscrbrs[s].sbscrbr_notes)),"first"in Sbscrbrs[s]?$(".wp_registered").show():$(".wp_registered").hide(),$('#fltr_sbscrbr_results input[type="button"]').removeAttr("disabled"),$("#sbscrbr_details").show()):$("#sbscrbr_details").hide()}function srt_by(s,r,t){return function(e,_){return!isNaN(e[s])&&!isNaN(_[s])&&parseInt(e[s])-parseInt(_[s])>0||null==e[s]&&null!=_[s]||null!=e[s]&&isNaN(e[s])&&null!=_[s]&&isNaN(_[s])&&e[s].toLowerCase()>_[s].toLowerCase()?1:!isNaN(e[s])&&!isNaN(_[s])&&parseInt(e[s])-parseInt(_[s])<0||null!=e[s]&&null==_[s]||null!=e[s]&&isNaN(e[s])&&null!=_[s]&&isNaN(_[s])&&e[s].toLowerCase()<_[s].toLowerCase()?-1:!isNaN(e[r])&&!isNaN(_[r])&&parseInt(e[r])-parseInt(_[r])>0||null==e[r]&&null!=_[r]||null!=e[r]&&isNaN(e[r])&&null!=_[r]&&isNaN(_[r])&&e[r].toLowerCase()>_[r].toLowerCase()?1:!isNaN(e[r])&&!isNaN(_[r])&&parseInt(e[r])-parseInt(_[r])<0||null!=e[r]&&null==_[r]||null!=e[r]&&isNaN(e[r])&&null!=_[r]&&isNaN(_[r])&&e[r].toLowerCase()<_[r].toLowerCase()?-1:!isNaN(e[t])&&!isNaN(_[t])&&parseInt(e[t])-parseInt(_[t])>0||null==e[t]&&null!=_[t]||null!=e[t]&&isNaN(e[t])&&null!=_[t]&&isNaN(_[t])&&e[t].toLowerCase()>_[t].toLowerCase()?1:!isNaN(e[t])&&!isNaN(_[t])&&parseInt(e[t])-parseInt(_[t])<0||null!=e[t]&&null==_[t]||null!=e[t]&&isNaN(e[t])&&null!=_[t]&&isNaN(_[t])&&e[t].toLowerCase()<_[t].toLowerCase()?-1:0}}$=jQuery;